
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A site for knowledge sharing and neat things.">
      
      
        <link rel="canonical" href="http://copperlight.github.io/ansible/ansible-vault-and-ssh-key-distribution/">
      
      
        <meta name="author" content="Matthew Johnson">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.10.1">
    
    
      
        <title>Ansible Vault and SSH Key Distribution - Copperlight Writes</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-a20f419c8e.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Menlo">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Menlo","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://copperlight.github.io/" title="Copperlight Writes" class="md-header-nav__button md-logo">
          
            <i class="md-icon md-icon--home"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Ansible
                </span>
              
            
            Ansible Vault and SSH Key Distribution
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/copperlight/copperlight.github.io" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <div class="md-nav__button md-logo">
      
        <i class="md-icon md-icon--home"></i>
      
    </div>
    Copperlight Writes
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/copperlight/copperlight.github.io" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Ansible
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Ansible
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="Ansible Vault and SSH Key Distribution" class="md-nav__link md-nav__link--active">
      Ansible Vault and SSH Key Distribution
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../running-ansible-playbooks-on-windows/" title="Running Ansible Playbooks on Windows" class="md-nav__link">
      Running Ansible Playbooks on Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing-ansible-galaxy-roles-with-docker/" title="Testing Ansible Galaxy Roles with Docker" class="md-nav__link">
      Testing Ansible Galaxy Roles with Docker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/aws-credential-files-for-java-and-python/" title="AWS Credential Files for Java and Python" class="md-nav__link">
      AWS Credential Files for Java and Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/build-a-fake-instance-metadata-server-for-ubuntu-on-vagrant/" title="Build a Fake Instance Metadata Server for Ubuntu on Vagrant" class="md-nav__link">
      Build a Fake Instance Metadata Server for Ubuntu on Vagrant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws/configuring-multiple-interfaces-on-the-same-network-in-ec2/" title="Configuring Multiple Interfaces on the Same Network in EC2" class="md-nav__link">
      Configuring Multiple Interfaces on the Same Network in EC2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      GitHub
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        GitHub
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../github/how-i-built-my-blog/" title="How I Built My Blog" class="md-nav__link">
      How I Built My Blog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux/linux-ftrace-delivers-dtrace-like-functionality/" title="Linux ftrace Delivers dtrace-like Functionality" class="md-nav__link">
      Linux ftrace Delivers dtrace-like Functionality
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/building-rest-apis-with-python-flask/" title="Building REST APIs with Python Flask" class="md-nav__link">
      Building REST APIs with Python Flask
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/install-the-latest-python-versions-on-macosx/" title="Install the Latest Python Versions on Mac OSX" class="md-nav__link">
      Install the Latest Python Versions on Mac OSX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/stop-using-print-for-debugging/" title="Stop Using "print" for Debugging" class="md-nav__link">
      Stop Using "print" for Debugging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Scala
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Scala
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../scala/starting-scala-repls-with-gradle-and-sbt/" title="Starting Scala REPLs with Gradle and SBT" class="md-nav__link">
      Starting Scala REPLs with Gradle and SBT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scala/using-the-scala-repl-to-configure-amazon-ses-notifications/" title="Using the Scala REPL to Configure Amazon SES Notifications" class="md-nav__link">
      Using the Scala REPL to Configure Amazon SES Notifications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Shell
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Shell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../shell/measuring-transfer-speed-over-time-with-curl/" title="Measuring Transfer Speed Over Time with cURL" class="md-nav__link">
      Measuring Transfer Speed Over Time with cURL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../shell/parsing-json-on-the-command-line/" title="Parsing JSON on the Command Line" class="md-nav__link">
      Parsing JSON on the Command Line
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Talks
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Talks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../talks/netflix-atlas-telemetry-a-platform-begets-an-ecosystem/" title="Netflix Atlas Telemetry - A Platform Begets an Ecosystem" class="md-nav__link">
      Netflix Atlas Telemetry - A Platform Begets an Ecosystem
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="ansible-vault-and-ssh-key-distribution">Ansible Vault and SSH Key Distribution<a class="headerlink" href="#ansible-vault-and-ssh-key-distribution" title="Permanent link">&para;</a></h1>
<p><small>2014-06-30</small></p>
<p>There are two types of SSH key distribution discussed in this post: private keys on local hosts and
public keys on remote hosts.  SSH private key distribution is best used for setting up your own
workstation or possibly an <a href="http://www.ansible.com/tower">Ansible Tower</a> server.  In general, you
should not be distributing private keys widely; with a good SSH tunneling configuration and SSH
public key distribution, there should be no need for the private keys to be installed in more than
few places.  This configuration will show off a technique for configuring an SSH jump host bastion
that allows you to keep your private key on your own workstation; there is no need to have the SSH
private key on the bastion host.</p>
<p>For the purpose of this post, I have generated a new SSH key pair to demonstrate this technique;
this keypair is used nowhere.  Part of the trick to making this work is that the private key needs
to be base64 encoded so that line breaks are preserved when it is stored as a yaml string in the
<code>vars_files</code>.  Template files are created for the public and private keys to preserve file change
detection.</p>
<p>Generate a new key pair:</p>
<div class="codehilite"><pre><span></span>$ ssh-keygen -b <span class="m">2048</span> -f junk_key -C junk
Generating public/private rsa key pair.
Enter passphrase <span class="o">(</span>empty <span class="k">for</span> no passphrase<span class="o">)</span>:
Enter same passphrase again:
Your identification has been saved in junk_key.
Your public key has been saved in junk_key.pub.
The key fingerprint is:
<span class="m">94</span>:94:ae:ac:c3:5e:ee:7d:fa:2c:cb:0f:ae:19:c8:99 junk
The key<span class="err">&#39;</span>s randomart image is:
+--<span class="o">[</span> RSA <span class="m">2048</span><span class="o">]</span>----+
<span class="p">|</span>        ..       <span class="p">|</span>
<span class="p">|</span>       ...       <span class="p">|</span>
<span class="p">|</span>       .o        <span class="p">|</span>
<span class="p">|</span>       ..        <span class="p">|</span>
<span class="p">|</span>     . .S        <span class="p">|</span>
<span class="p">|</span>   . +o          <span class="p">|</span>
<span class="p">|</span>   .E.o .        <span class="p">|</span>
<span class="p">|</span>    +o *.o.      <span class="p">|</span>
<span class="p">|</span>   ..o<span class="o">=</span>.*B+      <span class="p">|</span>
+-----------------+
&lt;/pre&gt;
</pre></div>


<p>Base64 encode the private key:</p>
<div class="codehilite"><pre><span></span>base64 -i junk_key &gt; junk_key.b64
</pre></div>


<p>Create an Ansible vars_files yaml data file named <code>ssh_keys/ssh_key_vault.yml</code>.  The
<code>ssh_private_key</code> variable should contain the base64 encoded private key and the <code>ssh_public_key</code>
variable should contain the public key. Encrypt the file with <code>ansible-vault</code>:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ssh_private_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBeUtIRlhKWFJweXlCV2FobGExM2I5S2t1aGlwSHNkVkR4dDhaZnJrMWpqd1NnNEhCCmEzMzBnQnBxUFk1SkVxeEtPV0F3WWZleExwZ3VFcHk0Z2o5S1JxZGxTb0lsYllWbEtaUnY4RmhRSC9iT3lIKzAKVytJb0VzZ096MjR6U1ZQRU9ybWV6d3QzMzN0OWh0NDFsWVBBTHpzbkVaem9vVWE4ZTVKc1RzT0YzQzdmaUh3NApBSXZTOStWVUp5Mm8wUnZQN2ZMQkttV0FBN2dvWVA3d1Z6aVNQbEVrVVJIRGEyNXBVTmRTU1lxQzI2Y0c0UWNPCk14Q3VOeXdFRks0TGl5Q21zcHNXSnkzV3BkQ1FYQ0k1Q0J0SUVVTnR6Y1FpTFQvd0ZwbzRpRnp4NEREbkRsZWcKdkc2L1JHelFqMVJyeWRFdCtTNVdHenMzYkJHbDgxOWMvSmpPNVFJREFRQUJBb0lCQUYyQXZ5a3lEWDVheUlIUApjRXpFZG5Fa3M3RUZYVnBzcU9Tekx2K1hNM1Z4VzdOOE1uZDFRUkMrdnNxbldEamlvTWp5b2puV0pQWXhLQysyCmFHc1RNZnVSb2l4Q1VVMGtnUXdLeU14N2JBUXBreDl3SE05QnJDbHNvVEpkQ252ZkZUSEZObFVKNURqOEpYbEkKY0RLWkwyVVRyVmFSQ1AyNHFManllWldQbkFBTDZPc1JwSUc1Ukp1ays2QTVmVEppL0FVTmp4a2FIM1VOUklmTwpMZjYwOVJIUHZKUEtPNkNnNWVzK3RSY0VlbnR6ZVJxeENkYkh1b2NESjluUWNRQjVIVVBaeVdYOGwzODhJQ1hhCm5oaCt6VUhlYWY4cEM1dE9STGh0aDdsR1FFN3NOQ1FQRkovMHVCVWhleEVWREwxcU1Vd2JRZUpFU2orUmMrMi8KazRZeFhEVUNnWUVBNjhaNzRGUlJuUmViZy8xT2Z2K3ZlY0p2akEyRi9oWTBDVkpBOHdTcHdpNTlHTUpUS3g1TQpFWCtwNHBhMlY3NDZTZFFjY2l4K3hlWlhyZXkvbXhLWlByZnE0bVl1ZkJRRmVPT2tuWWdXTEhXUjV2cW1zUkFwCmZMQlhTbGdZNzV6SGFzSWJmOVlQZDhZQytLV1J4RlZyQml4eEtPQ2o1WFlrZmhoZkFnaDJsNnNDZ1lFQTJkZU4KM3FvR1lDM09GdllmWTJKVTQ4a2RvejNuT09uN09rd1pHNTFZOW5GM3JTYWpUeW9XRHpLTzc5MUNtK0hGNmhFWgpBWFlzeDlTcXJER1JYT2lvUi9ZMEpNVDZsS0ZuTUJpWERmRWROUVFCYStQQ3RFNWhqdTFoS1dPOHlIN21pZk1DCnQ0OHZBbGk5NEQxZjNxa2FjREtmRWVpa2VaazZaWWFhUWFTZ1k2OENnWUVBb0cxb3dzWjgxZWhIVURNZW96bDAKKytONkpSRGFtSDRoSUNxUXVRcjJPNE9JYVQxb2U5RmNyeGR2MEJiK3NZdGxlL0RRL2pzYWM2djlBd0l4aWVISQoxaTBzcktvY2ZSN2VibGh2SFNXSStPMXl2bmpVeld3UzNwM2FkMktrYlAzL2pydlBIRmZhSklSZVp6TzVrSjhTCmVKdnF6NGF5M3FKWnlGYnE1cVk5azRzQ2dZQmlzNVhtTTJkY0lLVG1KbkltVjZGYTYvN3Z2ZGFNSlFmZGJDbGMKSjdqdFFKQVc5aEM4aDdjaS82ZGY2d0tKR296UDl4czdYRTRCNU12SDVWV1ZvUnpPTGpHR0QzSHg4Z2VNOVRkTAo2OWx0OGZpcTU3R0tmSkViYjFhOHFDSWJQZFE2NE01MFdQM1Z0RnVqeEdzeHViRHU4U0M5dm9qM1I0UDhDRGJRClUwVVFwUUtCZ1FDc0pyMlBrdFl0QWJteHdCbUMrT1FVOFd4dHQwZ2ZoNGluZHpVV2J3MFZWY3Ivb3A5aDliekoKWG9TSVVSenQwUjZmNVVDK1RwQUdxY3ZPKzhtTUgwbnZpZ2VuYkhXdk01WFBuSUtwR2RLZmc4QkxUMUZnR2t3Ugpma2tydnpwWjM1dWpCTkRWdnl4ZWVCTyt2MTVqc0N1YTFTS0FsaXpzaWJrdE9lM1F1VTkwS3c9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=</span>

<span class="l l-Scalar l-Scalar-Plain">ssh_public_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDIocVcldGnLIFZqGVrXdv0qS6GKkex1UPG3xl+uTWOPBKDgcFrffSAGmo9jkkSrEo5YDBh97EumC4SnLiCP0pGp2VKgiVthWUplG/wWFAf9s7If7Rb4igSyA7PbjNJU8Q6uZ7PC3ffe32G3jWVg8AvOycRnOihRrx7kmxOw4XcLt+IfDgAi9L35VQnLajRG8/t8sEqZYADuChg/vBXOJI+USRREcNrbmlQ11JJioLbpwbhBw4zEK43LAQUrguLIKaymxYnLdal0JBcIjkIG0gRQ23NxCItP/AWmjiIXPHgMOcOV6C8br9EbNCPVGvJ0S35LlYbOzdsEaXzX1z8mM7l junk</span>
</pre></div>


<div class="codehilite"><pre><span></span>ansible-vault encrypt ssh_keys/ssh_key_vault.yml
Vault password:
Confirm Vault password:
Encryption successful
</pre></div>


<p>Create an inventory file named <code>inventory</code>, showing off the SSH jump host connection capability:</p>
<div class="codehilite"><pre><span></span><span class="k">[localhost]</span>
<span class="na">localhost ansible_connection</span><span class="o">=</span><span class="s">local</span>

<span class="k">[group-all:children]</span>
<span class="na">group-01</span>
<span class="na">group-02</span>

<span class="k">[group-01]</span>
<span class="na">i-00000001 ansible_ssh_host</span><span class="o">=</span><span class="s">bastion+192.168.1.1 ansible_ssh_user=remoteuser</span>
<span class="na">i-00000002 ansible_ssh_host</span><span class="o">=</span><span class="s">bastion+192.168.1.2 ansible_ssh_user=remoteuser</span>

<span class="k">[group-02]</span>
<span class="na">i-00000003 ansible_ssh_host</span><span class="o">=</span><span class="s">bastion+192.168.1.3 ansible_ssh_user=remoteuser</span>
<span class="na">i-00000004 ansible_ssh_host</span><span class="o">=</span><span class="s">bastion+192.168.1.4 ansible_ssh_user=remoteuser</span>
</pre></div>


<p>Create a template file for the private key named <code>templates/HOME_.ssh_junk</code>:</p>
<div class="codehilite"><pre><span></span><span class="cp">{{</span><span class="nv">ssh_private_key_decoded.stdout</span><span class="cp">}}</span><span class="x"></span>
</pre></div>


<p>Create a template file for the public key named <code>templates/HOME_.ssh_junk.pub</code>:</p>
<div class="codehilite"><pre><span></span><span class="cp">{{</span><span class="nv">ssh_public_key</span><span class="cp">}}</span><span class="x"></span>
</pre></div>


<p>Create a template file for the SSH jump host configuration named <code>templates/HOME_.ssh_config</code>:</p>
<div class="codehilite"><pre><span></span><span class="x">Host *</span>
<span class="x">    ServerAliveInterval 30</span>
<span class="x">    ServerAliveCountMax 5</span>

<span class="x">Host bastion</span>
<span class="x">    User </span><span class="cp">{{</span><span class="nv">remote_user</span><span class="cp">}}</span><span class="x"></span>
<span class="x">    IdentityFile ~/.ssh/junk</span>
<span class="x">    Hostname bastion</span>

<span class="x">Host bastion+*</span>
<span class="x">    User </span><span class="cp">{{</span><span class="nv">remote_user</span><span class="cp">}}</span><span class="x"></span>
<span class="x">    IdentityFile ~/.ssh/junk</span>
<span class="x">    ProxyCommand ssh -T -a bastion nc $(echo %h |cut -d+ -f2) %p 2&gt;/dev/null</span>
<span class="x">    StrictHostKeyChecking no</span>
</pre></div>


<p>This configuration assumes that you have a consistent remote username defined on the bastion server
and your protected hosts.</p>
<p>Write a playbook to install the SSH key and configuration on your local workstation named
<code>config_local-ssh.yml</code>:</p>
<div class="codehilite"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">configure local ssh</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="l l-Scalar l-Scalar-Plain">gather_facts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="l l-Scalar l-Scalar-Plain">sudo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">local_home</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,&#39;HOME&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">local_user</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,&#39;USER&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">remote_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">remoteuser</span>
  <span class="l l-Scalar l-Scalar-Plain">vars_files</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssh_keys/ssh_key_vault.yml</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">file</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">path={{local_home}}/.ssh state=directory mode=0700 owner={{local_user}}</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">src=templates/HOME_.ssh_config dest={{local_home}}/.ssh/config mode=0644 owner={{local_user}} backup=yes</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo {{ssh_private_key}} |base64 --decode</span>
    <span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ssh_private_key_decoded</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">src=templates/HOME_.ssh_junk dest={{local_home}}/.ssh/junk mode=0600 owner={{local_user}}</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">src=templates/HOME_.ssh_junk.pub dest={{local_home}}/.ssh/junk.pub mode=0644 owner={{local_user}}</span>
</pre></div>


<p>Run the playbook to setup your local workstation with SSH keys and configuration:</p>
<div class="codehilite"><pre><span></span>ansible-playbook -i inventory config_local-ssh.yml --ask-vault-pass
Vault password:
</pre></div>


<p>Test your SSH tunneling access to a remote host behind the bastion server:</p>
<div class="codehilite"><pre><span></span>ssh bastion+192.168.1.1
ssh bastion+192.168.1.1 <span class="s2">&quot;date; date &gt; /tmp/date.out&quot;</span>
scp bastion+192.168.1.1:/tmp/date.out .
</pre></div>


<p>Notice that the hosts behind the bastion server are referenced in the SSH command the same way that
they are referenced in the Ansible inventory file.  The "+" character used as a separator was
selected explicitly for its ability to be used interchangeably at the command line and in the
Ansible inventory.  IP addresses are being used on the right hand side of the expression since the
secondary connection to the protected host relies on the name resolution capabilities of the first
host in the tunnel.  If you had a reliable dynamic DNS service that was keeping up with changes to
the protected hosts and was accessible to the bastion host, then you could use host names instead,
such as <code>bastion+webserver01</code>.  This host selection technique can be extended to an Ansible dynamic
inventory script, if you were running instances at a cloud provider such as AWS.  When you write a
<a href="http://docs.ansible.com/developing_inventory.html">dynamic inventory script</a>, the data format
should look like this:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;group-01&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;hosts&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;i-00000001&quot;</span><span class="p">,</span>
            <span class="s2">&quot;i-00000002&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;group-02&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;hosts&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;i-00000003&quot;</span><span class="p">,</span>
            <span class="s2">&quot;i-00000004&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;group-all&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;children&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;group-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;group-02&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;localhost&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;localhost&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;_meta&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;hostvars&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;i-00000001&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;ansible_ssh_host&quot;</span><span class="p">:</span> <span class="s2">&quot;bastion+192.168.1.1&quot;</span><span class="p">,</span>
                <span class="nt">&quot;ansible_ssh_user&quot;</span><span class="p">:</span> <span class="s2">&quot;remoteuser&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;i-00000002&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;ansible_ssh_host&quot;</span><span class="p">:</span> <span class="s2">&quot;bastion+192.168.1.2&quot;</span><span class="p">,</span>
                <span class="nt">&quot;ansible_ssh_user&quot;</span><span class="p">:</span> <span class="s2">&quot;remoteuser&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;i-00000003&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;ansible_ssh_host&quot;</span><span class="p">:</span> <span class="s2">&quot;bastion+192.168.1.3&quot;</span><span class="p">,</span>
                <span class="nt">&quot;ansible_ssh_user&quot;</span><span class="p">:</span> <span class="s2">&quot;remoteuser&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;i-00000004&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;ansible_ssh_host&quot;</span><span class="p">:</span> <span class="s2">&quot;bastion+192.168.1.4&quot;</span><span class="p">,</span>
                <span class="nt">&quot;ansible_ssh_user&quot;</span><span class="p">:</span> <span class="s2">&quot;remoteuser&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;localhost&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;ansible_connection&quot;</span><span class="p">:</span> <span class="s2">&quot;local&quot;</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The nice thing about this style of SSH configuration is that you can have multiple bastion hosts in
different locations and target the hosts behind each of them, provided that you give your bastion
hosts different names.  The method of accessing them is the same between direct SSH connections and
Ansible execution.  Once you have this infrastructure in place, you can start distributing public
SSH keys to your protected hosts.</p>
<p>Write a <code>templates/etc_sudoers</code> file that grants NOPASSWD access to the sudo group:</p>
<div class="codehilite"><pre><span></span><span class="n">Defaults</span>    <span class="n">env_reset</span>
<span class="n">Defaults</span>    <span class="n">mail_badpass</span>
<span class="n">Defaults</span>    <span class="n">secure_path</span><span class="o">=</span><span class="s">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>

<span class="cp"># Host alias specification</span>

<span class="cp"># User alias specification</span>

<span class="cp"># Cmnd alias specification</span>

<span class="cp"># User privilege specification</span>
<span class="n">root</span>    <span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="nl">ALL</span><span class="p">:</span><span class="n">ALL</span><span class="p">)</span> <span class="n">ALL</span>

<span class="cp"># Allow members of group sudo to execute any command</span>
<span class="nf">%sudo</span>   <span class="n">ALL</span><span class="o">=</span><span class="nl">NOPASSWD</span><span class="p">:</span> <span class="n">ALL</span>

<span class="cp">#include</span><span class="cpf">dir /etc/sudoers.d</span><span class="cp"></span>
</pre></div>


<p>Write a playbook <code>update_remote-ssh.yml</code> to configure NOPASSWD sudo access for your remote user and
distribute SSH public keys on your remote hosts.  This will allow subsequent playbook execution to
operate more easily against your remote hosts.  In order for this to work, the paramiko connection
type must be used initially, so that the password can be requested once and re-used across all hosts.</p>
<div class="codehilite"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">update remote ssh</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">group-all</span>
  <span class="l l-Scalar l-Scalar-Plain">gather_facts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="l l-Scalar l-Scalar-Plain">sudo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">connection</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">paramiko</span>
  <span class="l l-Scalar l-Scalar-Plain">vars_files</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssh_keys/ssh_key_vault.yml</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">copy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">src=templates/etc_sudoers dest=/etc/sudoers mode=0440 owner=root group=root</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">name=remoteuser groups=sudo shell=/bin/bash state=present</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">authorized_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">user=remoteuser state=present key={{ssh_public_key}}</span>
</pre></div>


<p>Run an SSH configuration playbook against remote hosts through the SSH tunnel, providing the SSH
password, sudo password and vault password:</p>
<div class="codehilite"><pre><span></span>ansible-playbook -i inventory update_remote-ssh.yml --ask-pass --ask-sudo-pass --ask-vault-pass
SSH password:
sudo password <span class="o">[</span>defaults to SSH password<span class="o">]</span>:
Vault password:

PLAY <span class="o">[</span>update ssh<span class="o">]</span> *************************************************************

TASK: <span class="o">[</span>copy <span class="nv">src</span><span class="o">=</span>templates/etc_sudoers <span class="nv">dest</span><span class="o">=</span>/etc/sudoers <span class="nv">mode</span><span class="o">=</span><span class="m">0440</span> <span class="nv">owner</span><span class="o">=</span>root <span class="nv">group</span><span class="o">=</span>root<span class="o">]</span> ***
ok: <span class="o">[</span>i-00000001<span class="o">]</span>
ok: <span class="o">[</span>i-00000002<span class="o">]</span>
ok: <span class="o">[</span>i-00000003<span class="o">]</span>
ok: <span class="o">[</span>i-00000004<span class="o">]</span>

TASK: <span class="o">[</span>user <span class="nv">name</span><span class="o">=</span>remoteuser <span class="nv">groups</span><span class="o">=</span>sudo <span class="nv">shell</span><span class="o">=</span>/bin/bash <span class="nv">state</span><span class="o">=</span>present<span class="o">]</span> ***
ok: <span class="o">[</span>i-00000001<span class="o">]</span>
ok: <span class="o">[</span>i-00000002<span class="o">]</span>
ok: <span class="o">[</span>i-00000003<span class="o">]</span>
ok: <span class="o">[</span>i-00000004<span class="o">]</span>

TASK: <span class="o">[</span>authorized_key <span class="nv">user</span><span class="o">=</span>remoteuser <span class="nv">state</span><span class="o">=</span>present <span class="nv">key</span><span class="o">=</span><span class="s2">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDIocVcldGnLIFZqGVrXdv0qS6GKkex1UPG3xl+uTWOPBKDgcFrffSAGmo9jkkSrEo5YDBh97EumC4SnLiCP0pGp2VKgiVthWUplG/wWFAf9s7If7Rb4igSyA7PbjNJU8Q6uZ7PC3ffe32G3jWVg8AvOycRnOihRrx7kmxOw4XcLt+IfDgAi9L35VQnLajRG8/t8sEqZYADuChg/vBXOJI+USRREcNrbmlQ11JJioLbpwbhBw4zEK43LAQUrguLIKaymxYnLdal0JBcIjkIG0gRQ23NxCItP/AWmjiIXPHgMOcOV6C8br9EbNCPVGvJ0S35LlYbOzdsEaXzX1z8mM7l junk&quot;</span><span class="o">]</span> ***
ok: <span class="o">[</span>i-00000001<span class="o">]</span>
ok: <span class="o">[</span>i-00000002<span class="o">]</span>
ok: <span class="o">[</span>i-00000003<span class="o">]</span>
ok: <span class="o">[</span>i-00000004<span class="o">]</span>


PLAY RECAP ********************************************************************
i-00000001               : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
i-00000002               : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
i-00000003               : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
i-00000004               : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
</pre></div>


<p>The best way to keep Ansible output concise is to run without verbosity -- only crank this up if you
need it to diagnose a problem.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../.." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../running-ansible-playbooks-on-windows/" title="Running Ansible Playbooks on Windows" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Running Ansible Playbooks on Windows
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-f3ab9e5ff8.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-52382416-1","copperlight.github.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>